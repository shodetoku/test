name: Discord GitHub Notifications

on:
  push:
    branches:
      - "**"
  pull_request:
    types: [opened, synchronize, reopened, closed]

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          EVENT_NAME="${{ github.event_name }}"
          ACTOR="${{ github.actor }}"
          AVATAR_URL="https://github.com/${{ github.actor }}.png"
          REPO="${{ github.repository }}"
          BRANCH="${{ github.ref_name }}"
          TIME_ISO="$(date -u +"%Y-%m-%dT%H:%M:%SZ")"

          STATUS="${{ job.status }}"
          if [ "$STATUS" = "success" ]; then
            STATUS_TEXT="‚úÖ Success"
            COLOR=3066993   # green
          else
            STATUS_TEXT="‚ùå Failed"
            COLOR=15158332  # red
          fi

          if [ "$EVENT_NAME" = "push" ]; then
            TITLE="üöÄ New Push"
            MESSAGE="${{ github.event.head_commit.message }}"
            URL="${{ github.event.head_commit.url }}"
            EVENT_LABEL="Push"
          else
            ACTION="${{ github.event.action }}"
            TITLE=" Pull Request ‚Ä¢ $ACTION"
            MESSAGE="${{ github.event.pull_request.title }}"
            URL="${{ github.event.pull_request.html_url }}"
            EVENT_LABEL="Pull Request"
          fi

          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"username\": \"GitHub Bot\",
            \"avatar_url\": \"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\",
            \"embeds\": [{
              \"author\": {
                \"name\": \"$ACTOR\",
                \"icon_url\": \"$AVATAR_URL\",
                \"url\": \"https://github.com/$ACTOR\"
              },
              \"title\": \"$TITLE\",
              \"url\": \"$URL\",
              \"color\": $COLOR,
              \"description\": \"**$EVENT_LABEL Event** in **$REPO**\",
              \"fields\": [
                { \"name\": \" Branch\", \"value\": \"`$BRANCH`\", \"inline\": true },
                { \"name\": \" Status\", \"value\": \"$STATUS_TEXT\", \"inline\": true },
                { \"name\": \" Message\", \"value\": \"$MESSAGE\", \"inline\": false }
              ],
              \"timestamp\": \"$TIME_ISO\",
              \"footer\": {
                \"text\": \"GitHub Actions ‚Ä¢ Team Notifications\",
                \"icon_url\": \"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\"
              }
            }]
          }" \
          $DISCORD_WEBHOOK
